"use strict";(self["webpackChunkvideogatewayweb"]=self["webpackChunkvideogatewayweb"]||[]).push([[889],{8889:function(t,e,l){l.r(e),l.d(e,{default:function(){return f}});var a=function(){var t=this,e=t._self._c;return e("div",[e("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:t.addRules}},[t._v("新增模型")]),e("el-table",{staticClass:"mt-10",staticStyle:{width:"100%"},attrs:{data:t.modelList,"row-key":"model_id",load:t.loadChildren,"tree-props":{children:"children",hasChildren:"hasChildren"}},on:{"expand-change":t.handleExpand}},[e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function({row:l}){return[l.children&&l.children.length?e("div",{staticClass:"nested-container"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:l.children,"show-header":!0,"header-cell-style":{background:"#f5f7fa",color:"#000000"}}},[e("el-table-column",{attrs:{prop:"class_code",label:"编号"}}),e("el-table-column",{attrs:{prop:"class_name",label:"分类名称"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.editModelType(l.row)}}}),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.delData(l.row)}}},[e("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"}})])]}}],null,!0)})],1)],1):e("div",{staticClass:"d-center"},[t._v("暂无子数据")])]}}])}),e("el-table-column",{attrs:{label:"序号",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.$index+1))]}}])}),e("el-table-column",{attrs:{prop:"model_name",label:"模型名称",align:"center"}}),e("el-table-column",{attrs:{prop:"model_type",label:"模型类型",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(1==e.row.model_type?"rknn":"大模型")+" ")]}}])}),e("el-table-column",{attrs:{prop:"model_status",label:"模型状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(e){return t.changeStatus(l.row)}},model:{value:l.row.model_status,callback:function(e){t.$set(l.row,"model_status",e)},expression:"scope.row.model_status"}})]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(l){return[e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.addModelType(l.row)}}},[e("i",{staticClass:"el-icon-circle-plus-outline",attrs:{title:"新增"}})]),e("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(e){return t.editData(l.row)}}}),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.delData(l.row,1)}}},[e("i",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{title:"删除"}})])]}}])})],1),e("el-dialog",{attrs:{title:t.title,visible:t.addVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){t.addVisible=e}}},[e("el-form",{ref:"addForm",staticClass:"mt-20",attrs:{model:t.addForm,"label-width":"120px",size:"small"}},[e("el-form-item",{attrs:{label:"模型名称:",prop:"model_name"}},[e("el-input",{staticStyle:{width:"40%"},model:{value:t.addForm.model_name,callback:function(e){t.$set(t.addForm,"model_name",e)},expression:"addForm.model_name"}})],1),e("el-form-item",{attrs:{label:"模型类型:",prop:"model_type"}},[e("el-select",{attrs:{size:"small"},model:{value:t.addForm.model_type,callback:function(e){t.$set(t.addForm,"model_type",e)},expression:"addForm.model_type"}},[e("el-option",{attrs:{label:"rknn",value:1}}),e("el-option",{attrs:{label:"大模型",value:2}})],1)],1),e("el-form-item",{attrs:{label:"模型:"}},[e("Upload",{ref:"Upload",attrs:{file:t.fileList}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("addForm")}}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{title:t.typeTitle,visible:t.typeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(e){t.typeVisible=e}}},[e("el-form",{ref:"addForm",staticClass:"mt-20",attrs:{model:t.addForm,"label-width":"120px",size:"small"}},[e("el-form-item",{attrs:{label:"模型名称:"}},[t._v(t._s(t.updetaData.model_name)+" ")]),e("el-form-item",{attrs:{label:"编号:",prop:"class_code"}},[e("el-input",{model:{value:t.addForm.class_code,callback:function(e){t.$set(t.addForm,"class_code",e)},expression:"addForm.class_code"}})],1),e("el-form-item",{attrs:{label:"分类名称:",prop:"class_name"}},[e("el-input",{model:{value:t.addForm.class_name,callback:function(e){t.$set(t.addForm,"class_name",e)},expression:"addForm.class_name"}})],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.typeVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitTypeForm("addForm")}}},[t._v("确 定")])],1)],1)],1)},i=[],s=(l(3239),l(3325),function(){var t=this,e=t._self._c;return e("div",{staticClass:"upload-file"},[e("el-upload",{ref:"lease",staticClass:"upload-file-uploader",attrs:{action:"",multiple:"","before-upload":t.handleBeforeUpload,"file-list":t.fileList,limit:t.limit,"show-file-list":!1,"http-request":t.changeFile}},[t.limit>t.fileList.length?e("el-button",{attrs:{size:"mini",type:"text"}},[t._v("上传模型")]):e("transition-group",{staticClass:"upload-file-list el-upload-list el-upload-list--text",attrs:{name:"el-fade-in-linear",tag:"ul"}},t._l(t.fileList,function(l,a){return e("li",{key:a,staticClass:"el-upload-list__item ele-upload-list__item-content"},[e("span",{staticClass:"el-icon-document"},[t._v(" "+t._s(l.name)+" ")]),e("div",{staticClass:"ele-upload-list__item-content-action"},[e("el-link",{attrs:{underline:!1,type:"danger"},on:{click:function(e){return t.handleDeleteFile(a)}}},[t._v("删除")])],1)])}),0),t.showTip?e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 请上传 "),t.fileSize?[t._v(" 大小不超过 "),e("b",{staticStyle:{color:"#f56c6c"}},[t._v(t._s(t.fileSize)+"MB")])]:t._e(),t.fileType?[t._v(" 格式为 "),e("b",{staticStyle:{color:"#f56c6c"}},[t._v(t._s(t.fileType.join("/")))])]:t._e(),t._v(" 的文件 ")],2):t._e()],1)],1)}),o=[],d=(l(5786),l(2563),{props:{file:{type:Array,default:()=>[]}},data(){return{fileList:[],fileType:["rknn"],fileName:"",number:0,headers:{Authorization:"Bearer "+localStorage.getItem("token")},uploadList:[],fileSize:20,isShowTip:!0,limit:1}},computed:{showTip(){return this.fileType}},created(){this.fileList=[...this.file]},watch:{file:{handler(t){this.fileList=[...t]},deep:!0,immediate:!0}},methods:{changeFile(t){this.fileList.push(t.file)},handleBeforeUpload(t){if(this.fileType){let e="";t.name.lastIndexOf(".")>-1&&(e=t.name.slice(t.name.lastIndexOf(".")+1));const l=this.fileType.some(l=>t.type.indexOf(l)>-1||!!(e&&e.indexOf(l)>-1));if(!l)return this.$modal.msgError(`文件格式不正确, 请上传${this.fileType.join("/")}格式文件!`),!1}if(this.fileSize){const e=t.size/1024/1024<this.fileSize;if(!e)return this.$modal.msgError(`上传文件大小不能超过 ${this.fileSize} MB!`),!1}return this.number++,!0},handleDeleteFile(t){this.fileList.splice(t,1),this.$emit("input",this.listToString(this.fileList))},getFileName(t){return t.lastIndexOf("/")>-1?t.slice(t.lastIndexOf("/")+1):""},listToString(t,e){let l="";e=e||",";for(let a in t)l+=t[a].url+e;return""!=l?l.substr(0,l.length-1):""}}}),n=d,r=l(6790),c=(0,r.A)(n,s,o,!1,null,"75f68312",null),m=c.exports,u={components:{Upload:m},data(){return{modelList:[],addForm:{},addVisible:!1,title:"新增模型",addRulesObject:{},updetaData:{},typeTitle:"新增模型分类",typeVisible:!1,fileList:[],loading:!1}},created(){this.getModelList()},methods:{async loadChildren(t,e,l){this.updetaData=t;try{const e=await this.fetchChildrenData(t.model_id);l(e)}catch(a){console.error("加载子数据失败:",a),l([])}},fetchChildrenData(t){return new Promise(e=>{this.$api.get("/ai/getDataModelClassList",{params:{model_id:t}}).then(t=>{e(t.data.data)})})},handleExpand(t,e){e&&!t.children&&this.loadChildren(t,null,e=>{this.$set(t,"children",e)})},changeStatus(t){this.$api.post("/ai/setDataModelStatus",{model_id:t.model_id,model_status:t.model_status}).then(()=>{this.$message.success("操作成功"),this.getModelList()}).catch(()=>{t.model_status=1===t.model_status?2:1})},updetaClassData(){const t=this.modelList.findIndex(t=>t.model_id===this.updetaData.model_id);-1!==t&&this.$api.get("/ai/getDataModelClassList",{params:{model_id:this.updetaData.model_id}}).then(e=>{this.$set(this.modelList[t],"children",e.data.data)})},submitTypeForm(){const t=!!this.addForm.class_id,e=t?"/ai/updateDataModelClass":"/ai/addDataModelClass";this.addForm.class_code=Number(this.addForm.class_code),this.$api.post(e,this.addForm).then(()=>{this.typeVisible=!1,this.$message.success("操作成功"),this.updetaClassData()})},editModelType(t){this.typeVisible=!0,this.addForm={...t}},addModelType(t){this.updetaData=t,this.addForm={model_id:this.updetaData.model_id},this.typeVisible=!0},submitForm(){let t=new FormData;this.addForm.model_file=this.$refs.Upload.fileList[0],this.isFile(this.addForm.model_file)&&t.append("model_file",this.addForm.model_file),t.append("model_name",this.addForm.model_name),t.append("model_type",this.addForm.model_type);const e=!!this.addForm.model_id,l=e?"/ai/updateDataModel":"/ai/addDataModel";e&&t.append("model_id",this.addForm.model_id),this.$api.post(l,t,{headers:{"Content-Type":"multipart/form-data"}}).then(()=>{this.addVisible=!1,this.$message.success("操作成功"),this.getModelList()})},delData(t,e){const l=!!e;let a,i;l?(a="/ai/delDataModel",i={model_id:t.model_id}):(a="/ai/delDataModelClass",i={class_id:t.class_id}),this.$confirm("是否删除该数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$api.post(a,i).then(()=>{this.$message.success("操作成功"),l?this.getModelList():this.updetaClassData()})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},editData(t){this.updetaData=t,this.title="编辑模型",this.addVisible=!0,this.addForm={...t},this.fileList=this.addForm.model_file.split().map(t=>({name:t}))},addRules(t){this.addForm={},this.fileList=[],this.title="新增模型",this.addVisible=!0,this.updetaData=t},load(t){t.childrenLoaded||this.getChildren(t,1)},getChildren(t){t.loading=!0,this.$api.get("/ai/getDataModelClassList",{params:{model_id:t.model_id}}).then(e=>{t.children=e.data.data,this.$set(t,"loading",!1),t.childrenLoaded=!0,this.updetaData=t}).finally(()=>{this.$set(t,"loading",!1)})},getModelList(){this.$api.get("/ai/getDataModelList").then(t=>{this.modelList=t.data.data.map(t=>({...t,hasChildren:!0}))})},isFile(t){return t instanceof File||t&&"object"===typeof t&&"File"===t.constructor.name}}},p=u,h=(0,r.A)(p,a,i,!1,null,"4610d67e",null),f=h.exports}}]);
//# sourceMappingURL=889.01724a98.js.map