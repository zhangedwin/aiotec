"use strict";(self["webpackChunkvideogatewayweb"]=self["webpackChunkvideogatewayweb"]||[]).push([[53],{5053:function(e,t,i){i.r(t),i.d(t,{default:function(){return x}});var o=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.pageShow?t("div",{staticClass:"d-flex wrap"},[t("div",{staticClass:"dataList",on:{click:e.addData}},[t("i",{staticClass:"el-icon-plus"}),e._v("添加数据应用 ")]),e._l(e.dataList,function(i,o){return t("div",{key:o,staticClass:"dataList"},[t("div",{staticClass:"item"},[t("div",{staticClass:"flex-interval"},[t("div",[e._v(" "+e._s(i.apply_name)),t("i",{staticClass:"el-icon-edit el-icon",attrs:{title:"编辑"},on:{click:function(t){return e.editData(i)}}})]),t("div",{staticClass:"flex-interval",staticStyle:{width:"25%"}},[t("i",{staticClass:"el-icon-setting el-icon",attrs:{title:"配置"},on:{click:function(t){return e.configData(i)}}}),t("i",{staticClass:"el-icon-tickets el-icon",attrs:{title:"日志"}}),t("i",{staticClass:"el-icon-price-tag el-icon",attrs:{title:"标签"}}),t("i",{staticClass:"el-icon-delete el-icon",staticStyle:{color:"red !important"},attrs:{title:"删除"},on:{click:function(t){return e.delData(i)}}})])]),t("div",{staticClass:"flex-interval mt-30"},[t("div",[e._v(e._s(1==i.apply_type?"mqtt转发":"http转发"))]),t("el-switch",{attrs:{"active-value":1,"inactive-value":2},on:{change:function(t){return e.changeState(i)}},model:{value:i.apply_status,callback:function(t){e.$set(i,"apply_status",t)},expression:"item.apply_status"}})],1)])])}),t("el-dialog",{attrs:{title:"添加数据应用",visible:e.addVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.addVisible=t}}},[t("el-form",{ref:"addForm",staticClass:"mt-20",attrs:{model:e.addForm,rules:e.rules,"label-width":"120px",size:"small"}},[t("el-form-item",{attrs:{label:"名称:",prop:"apply_name"}},[t("el-input",{model:{value:e.addForm.apply_name,callback:function(t){e.$set(e.addForm,"apply_name",t)},expression:"addForm.apply_name"}})],1),t("el-form-item",{attrs:{label:"应用类型:",prop:"apply_type"}},[t("el-select",{model:{value:e.addForm.apply_type,callback:function(t){e.$set(e.addForm,"apply_type",t)},expression:"addForm.apply_type"}},[t("el-option",{attrs:{label:"mqtt转发",value:1}}),t("el-option",{attrs:{label:"http转发",value:2}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("addForm")}}},[e._v("确 定")])],1)],1)],2):t("div",[t("el-page-header",{attrs:{content:e.configInfo.apply_name},on:{back:function(t){e.pageShow=!0}}}),t(e.componentName,{key:e.componentKey,ref:"configRef",tag:"component",attrs:{configForm:e.configForm},on:{sumbitData:e.submitConfigForm,submitThemeForm:e.submitThemeForm}})],1)])},a=[],r=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"上报配置",name:"1"}},[t("div",{staticClass:"flex-center"},[t("el-form",{ref:"report_config",staticClass:"mt-20",staticStyle:{width:"38%"},attrs:{model:e.report_config,rules:e.rules,"label-width":"140px",size:"small"}},[t("el-form-item",{attrs:{label:"上报类型:",prop:"report_type"}},[t("el-select",{model:{value:e.report_config.report_type,callback:function(t){e.$set(e.report_config,"report_type",t)},expression:"report_config.report_type"}},[t("el-option",{attrs:{value:1,label:"立即上报"}})],1)],1),t("el-form-item",{attrs:{label:"超时时间(秒):",prop:"timeout"}},[t("el-input-number",{attrs:{"controls-position":"right",min:10,max:60},model:{value:e.report_config.timeout,callback:function(t){e.$set(e.report_config,"timeout",t)},expression:"report_config.timeout"}})],1),t("el-form-item",{attrs:{label:"上报间隔(秒):",prop:"report_interval"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{"controls-position":"right",min:0},model:{value:e.report_config.report_interval,callback:function(t){e.$set(e.report_config,"report_interval",t)},expression:"report_config.report_interval"}})],1),t("el-form-item",[t("el-button",{on:{click:function(t){return e.submitConfigForm("report_config")}}},[e._v("提交")])],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"URL配置",name:"2"}},[t("el-button",{staticClass:"float-right",attrs:{type:"primary",size:"mini"},on:{click:e.addTheme}},[e._v("添加配置")]),t("div",[e._v("配置列表")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.http_config}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"200"}}),t("el-table-column",{attrs:{prop:"configuration_name",label:"名称",width:"200",align:"center"}}),t("el-table-column",{attrs:{prop:"report_type",label:"上报属性类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row?e.reportTypeList.get(t.row.report_type):""))]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.editTheme(i.$index)}}}),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.delTheme(i.$index)}}})]}}])})],1)],1)],1),t("el-dialog",{attrs:{title:e.addThemeTitle,visible:e.addThemeVisible,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.addThemeVisible=t}}},[t("el-form",{ref:"themeForm",staticClass:"mt-20",attrs:{model:e.themeForm,rules:e.rules,"label-width":"120px",size:"small"}},[t("el-form-item",{attrs:{label:"名称:",prop:"configuration_name"}},[t("el-input",{model:{value:e.themeForm.configuration_name,callback:function(t){e.$set(e.themeForm,"configuration_name",t)},expression:"themeForm.configuration_name"}})],1),t("el-form-item",{attrs:{label:"上报属性类型:",prop:"report_type"}},[t("el-select",{model:{value:e.themeForm.report_type,callback:function(t){e.$set(e.themeForm,"report_type",t)},expression:"themeForm.report_type"}},[t("el-option",{attrs:{label:"属性上报",value:1}}),t("el-option",{attrs:{label:"分析报警",value:3}})],1)],1),t("el-form-item",{attrs:{label:"请求地址:",prop:"request_address"}},[t("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入请求地址",prop:"hostUrl"},model:{value:e.themeForm.request_address,callback:function(t){e.$set(e.themeForm,"request_address",t)},expression:"themeForm.request_address"}},[t("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.themeForm.host_head,callback:function(t){e.$set(e.themeForm,"host_head",t)},expression:"themeForm.host_head"}},[t("el-option",{attrs:{value:"http"}}),t("el-option",{attrs:{value:"https"}})],1)],1)],1),t("el-form-item",{attrs:{label:"请求方法:",prop:"request_method"}},[t("el-select",{staticStyle:{width:"100px"},model:{value:e.themeForm.request_method,callback:function(t){e.$set(e.themeForm,"request_method",t)},expression:"themeForm.request_method"}},[t("el-option",{attrs:{label:"POST",value:1}}),t("el-option",{attrs:{label:"GET",value:2}})],1)],1),t("el-form-item",{attrs:{label:"请求头:",prop:"request_header"}},[e._l(e.requestHeadersList,function(i,o){return t("div",{key:o,staticClass:"flex-interval mb-10"},[t("el-input",{staticClass:"mr-10",attrs:{placeholder:"请输入参数名"},model:{value:i.key,callback:function(t){e.$set(i,"key",t)},expression:"item.key"}},[t("template",{slot:"prepend"},[e._v("键：")])],2),t("el-input",{staticClass:"mr-10",attrs:{placeholder:"请输入参数值"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}},[t("template",{slot:"prepend"},[e._v("值：")])],2),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",plain:""},on:{click:function(t){return e.delParamsItem(o,"requestHeadersList")}}})],1)}),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addParamsItem("requestHeadersList")}}},[e._v("+ 添加请求头")])],2),t("el-form-item",{attrs:{label:"请求参数:",prop:"request_parameters"}},[e._l(e.requestParamsList,function(i,o){return t("div",{key:o,staticClass:"flex-interval mb-10"},[t("el-input",{staticClass:"mr-10",attrs:{placeholder:"请输入参数名"},model:{value:i.key,callback:function(t){e.$set(i,"key",t)},expression:"item.key"}},[t("template",{slot:"prepend"},[e._v("键：")])],2),t("el-input",{staticClass:"mr-10",attrs:{placeholder:"请输入参数值"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}},[t("template",{slot:"prepend"},[e._v("值：")])],2),t("el-button",{attrs:{type:"danger",icon:"el-icon-delete",plain:""},on:{click:function(t){return e.delParamsItem(o,"requestParamsList")}}})],1)}),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addParamsItem("requestParamsList")}}},[e._v("+ 添加参数")])],2),t("el-form-item",{attrs:{label:"请求体:",prop:"request_body"}},[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.themeForm.request_body,callback:function(t){e.$set(e.themeForm,"request_body",t)},expression:"themeForm.request_body"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addThemeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitThemeForm("themeForm")}}},[e._v("确 定")])],1)],1)],1)},s=[],l=(i(5786),i(3239),i(2563),{props:{configForm:{type:Object,default:()=>({})}},data(){return{activeName:"1",report_config:{},http_config:[],rules:{},reportTypeList:new Map([[1,"属性上报"],[2,"属性设置"],[3,"分析报警"]]),themeForm:{},requestHeadersList:[],requestParamsList:[],addThemeTitle:"新增",addThemeVisible:!1}},watch:{configForm:{handler(e){({http_config:this.http_config,report_config:this.report_config}=e)},deep:!0,immediate:!0}},methods:{submitThemeForm(){const e=e=>Array.isArray(e)&&e.length>0?e:void 0;this.themeForm.request_header=e(this.requestHeadersList),this.themeForm.request_parameters=e(this.requestParamsList);let t="编辑"==this.addThemeTitle?"edit":"add";if("add"==t&&this.http_config.some(e=>e.report_type===this.themeForm.report_type))return this.$message.warning("只允许添加一种上报属性类型！");this.$emit("submitThemeForm",t,{themeForm:this.themeForm,..."edit"==t&&{themeIndex:this.themeIndex},configType:"http_config"})},delParamsItem(e,t){this[t].splice(e,1)},addParamsItem(e){this[e].push({})},delTheme(e){this.$confirm("是否删除该数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("submitThemeForm","del",{themeForm:this.themeForm,themeIndex:e,configType:"http_config"})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},editTheme(e){this.addThemeVisible=!0,this.themeIndex=e,this.addThemeTitle="编辑",this.themeForm={...this.http_config[this.themeIndex]},this.requestHeadersList=this.themeForm.request_header||[],this.requestParamsList=this.themeForm.request_parameters||[]},addTheme(){this.themeForm={},this.requestHeadersList=[],this.requestParamsList=[],this.addThemeTitle="新增",this.addThemeVisible=!0},submitConfigForm(e){this.$refs[e].validate(e=>{e&&this.$emit("sumbitData",{report_config:this.report_config,http_config:this.http_config})})},success(){this.addThemeVisible=!1}}}),n=l,c=i(6790),p=(0,c.A)(n,r,s,!1,null,"9b07ff34",null),m=p.exports,d=function(){var e=this,t=e._self._c;return t("div",[t("el-tabs",{staticClass:"mt-10",model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"服务器配置",name:"1"}},[t("div",{staticClass:"flex-center"},[t("el-form",{ref:"server_config",staticClass:"mt-20",staticStyle:{width:"35%"},attrs:{model:e.server_config,rules:e.rules,"label-width":"120px",size:"small"}},[t("el-form-item",{attrs:{label:"服务器地址:",prop:"address"}},[t("el-input",{model:{value:e.server_config.address,callback:function(t){e.$set(e.server_config,"address",t)},expression:"server_config.address"}})],1),t("el-form-item",{attrs:{label:"端口:",prop:"port"}},[t("el-input",{model:{value:e.server_config.port,callback:function(t){e.$set(e.server_config,"port",e._n(t))},expression:"server_config.port"}})],1),t("el-form-item",{attrs:{label:"Client ID:",prop:"client_id"}},[t("el-input",{model:{value:e.server_config.client_id,callback:function(t){e.$set(e.server_config,"client_id",t)},expression:"server_config.client_id"}})],1),t("el-form-item",{attrs:{label:"用户名:",prop:"user_name"}},[t("el-input",{model:{value:e.server_config.user_name,callback:function(t){e.$set(e.server_config,"user_name",t)},expression:"server_config.user_name"}})],1),t("el-form-item",{attrs:{label:"密码:",prop:"user_pwd"}},[t("el-input",{attrs:{type:"password","show-password":""},model:{value:e.server_config.user_pwd,callback:function(t){e.$set(e.server_config,"user_pwd",t)},expression:"server_config.user_pwd"}})],1),t("el-form-item",{attrs:{label:"Keep Alive:",prop:"keepalive"}},[t("el-input",{model:{value:e.server_config.keepalive,callback:function(t){e.$set(e.server_config,"keepalive",e._n(t))},expression:"server_config.keepalive"}})],1),t("el-form-item",{attrs:{label:"Qos:",prop:"qos"}},[t("el-radio-group",{model:{value:e.server_config.qos,callback:function(t){e.$set(e.server_config,"qos",t)},expression:"server_config.qos"}},[t("el-radio",{attrs:{label:0}},[e._v("0")]),t("el-radio",{attrs:{label:1}},[e._v("1")]),t("el-radio",{attrs:{label:2}},[e._v("2")])],1)],1),t("el-form-item",[t("el-button",{on:{click:function(t){return e.submitConfigForm("server_config")}}},[e._v("提交")])],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"连接通知配置",name:"2"}},[t("div",{staticClass:"flex-center"},[t("el-form",{ref:"notice_config",staticClass:"mt-20",staticStyle:{width:"35%"},attrs:{model:e.notice_config,rules:e.rules,"label-width":"150px",size:"small"}},[e._v(" 连接通知 "),t("el-form-item",{staticClass:"mt-10",attrs:{label:"连接通知主题:",prop:"notice_topic"}},[t("el-input",{model:{value:e.notice_config.notice_topic,callback:function(t){e.$set(e.notice_config,"notice_topic",t)},expression:"notice_config.notice_topic"}})],1),t("el-form-item",{attrs:{label:"连接通知消息:",prop:"notice_msg"}},[t("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.notice_config.notice_msg,callback:function(t){e.$set(e.notice_config,"notice_msg",t)},expression:"notice_config.notice_msg"}})],1),e._v(" 遗嘱消息 "),t("el-form-item",{staticClass:"mt-10",attrs:{label:"遗嘱消息主题:",prop:"dyingwords_topic"}},[t("el-input",{model:{value:e.notice_config.dyingwords_topic,callback:function(t){e.$set(e.notice_config,"dyingwords_topic",t)},expression:"notice_config.dyingwords_topic"}})],1),t("el-form-item",{attrs:{label:"遗嘱消息Qos:",prop:"dyingwords_qos"}},[t("el-radio-group",{model:{value:e.notice_config.dyingwords_qos,callback:function(t){e.$set(e.notice_config,"dyingwords_qos",t)},expression:"notice_config.dyingwords_qos"}},[t("el-radio",{attrs:{label:0}},[e._v("0")]),t("el-radio",{attrs:{label:1}},[e._v("1")]),t("el-radio",{attrs:{label:2}},[e._v("2")])],1)],1),t("el-form-item",{attrs:{label:"遗嘱消息保留标志:",prop:"dyingwords_retain"}},[t("el-checkbox",{attrs:{"true-label":1,"false-label":2},model:{value:e.notice_config.dyingwords_retain,callback:function(t){e.$set(e.notice_config,"dyingwords_retain",t)},expression:"notice_config.dyingwords_retain"}})],1),t("el-form-item",{attrs:{label:"遗嘱消息:",prop:"dyingwords_msg"}},[t("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.notice_config.dyingwords_msg,callback:function(t){e.$set(e.notice_config,"dyingwords_msg",t)},expression:"notice_config.dyingwords_msg"}})],1),t("el-form-item",[t("el-button",{on:{click:function(t){return e.submitConfigForm("notice_config")}}},[e._v("提交")])],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"上报配置",name:"3"}},[t("div",{staticClass:"flex-center"},[t("el-form",{ref:"report_config",staticClass:"mt-20",staticStyle:{width:"35%"},attrs:{model:e.report_config,rules:e.rules,"label-width":"180px",size:"small"}},[t("el-form-item",{attrs:{label:"上报类型:",prop:"report_type"}},[t("el-select",{model:{value:e.report_config.report_type,callback:function(t){e.$set(e.report_config,"report_type",t)},expression:"report_config.report_type"}},[t("el-option",{attrs:{label:"立即上报",value:1}}),t("el-option",{attrs:{label:"周期上报",value:2}})],1)],1),t("el-form-item",{attrs:{label:"上报周期:",prop:"report_cycle"}},[t("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.report_config.report_cycle,callback:function(t){e.$set(e.report_config,"report_cycle",e._n(t))},expression:"report_config.report_cycle"}},[t("template",{slot:"append"},[e._v("秒")])],2)],1),t("el-form-item",[t("el-button",{on:{click:function(t){return e.submitConfigForm("report_config")}}},[e._v("提交")])],1)],1)],1)]),t("el-tab-pane",{attrs:{label:"主题配置",name:"4"}},[t("el-button",{staticClass:"float-right",attrs:{type:"primary",size:"mini"},on:{click:e.addTheme}},[e._v("添加主题")]),t("div",[e._v("主题列表")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.topic_config}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"topic_name",label:"主题",align:"center",width:"260"}}),t("el-table-column",{attrs:{prop:"topic_type",label:"主题类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.reportTypeList.get(t.row.topic_type)))]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.editTheme(i.row,i.$index)}}}),t("el-button",{staticStyle:{color:"red"},attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.delTheme(i.row,i.$index)}}})]}}])})],1)],1)],1),t("el-dialog",{attrs:{title:e.addThemeTitle,visible:e.addThemeVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.addThemeVisible=t}}},[t("div",{staticClass:"d-flex f-center",staticStyle:{padding:"10px",background:"aliceblue",border:"1px solid #3aacf5"}},[t("i",{staticClass:"el-icon-warning-outline mr-5 fs-18",staticStyle:{color:"#3aacf5"}}),e._v("可用主题通配符:${tag:key}-数据源标签 ")]),t("el-form",{ref:"themeForm",staticClass:"mt-20",attrs:{model:e.themeForm,rules:e.rules,"label-width":"120px",size:"small"}},[t("el-form-item",{attrs:{label:"主题:",prop:"topic_name"}},[t("el-input",{model:{value:e.themeForm.topic_name,callback:function(t){e.$set(e.themeForm,"topic_name",t)},expression:"themeForm.topic_name"}})],1),t("el-form-item",{attrs:{label:"上报属性类型:",prop:"topic_type"}},[t("el-select",{model:{value:e.themeForm.topic_type,callback:function(t){e.$set(e.themeForm,"topic_type",t)},expression:"themeForm.topic_type"}},[t("el-option",{attrs:{label:"属性上报",value:1}}),t("el-option",{attrs:{label:"属性设置",value:2}}),t("el-option",{attrs:{label:"分析报警",value:3}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addThemeVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitThemeForm("themeForm")}}},[e._v("确 定")])],1)],1)],1)},u=[],f={props:{configForm:{type:Object,default:()=>({})}},data(){let e=(e,t,i)=>{const o=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;o.test(t)?i():i(new Error("格式错误 格式:XXX.XXX.XXX.XXX"))},t=(e,t,i)=>{/^[1-9]\d*$/.test(t)&&1<=1*t&&1*t<=65535?i():i(new Error("端口为0-65535"))};return{activeName:"1",server_config:{},notice_config:{},report_config:{},topic_config:[],rules:{apply_name:[{required:!0,message:"请输入",trigger:"blur"}],apply_type:[{required:!0,message:"请选择",trigger:"change"}],address:[{required:!0,message:"请输入",trigger:"blur"},{validator:e,trigger:"change"}],port:[{required:!0,message:"请输入",trigger:"blur"},{validator:t,trigger:"change"}],keepalive:[{required:!0,message:"请输入",trigger:"blur"}],qos:[{required:!0,message:"请输入",trigger:"blur"}],report_type:[{required:!0,message:"请选择",trigger:"change"}],report_cycle:[{required:!0,message:"请输入",trigger:"blur"}]},reportTypeList:new Map([[1,"属性上报"],[2,"属性设置"],[3,"分析报警"]]),themeForm:{},addThemeTitle:"新增",addThemeVisible:!1}},watch:{configForm:{handler(e){this.server_config={keepalive:e.server_config.server_config||60,qos:e.server_config.qos||0,...e.server_config},this.notice_config=e.notice_config,this.report_config=e.report_config,this.topic_config=e.topic_config},deep:!0,immediate:!0}},created(){},methods:{delTheme(e){this.$confirm("是否删除该数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$emit("submitThemeForm","del",{themeForm:this.themeForm,themeIndex:e,configType:"topic_config"})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},editTheme(e,t){this.themeIndex=t,this.addThemeVisible=!0,this.addThemeTitle="编辑",this.themeForm={...this.topic_config[t]}},submitThemeForm(){let e="编辑"==this.addThemeTitle?"edit":"add";this.$emit("submitThemeForm",e,{themeForm:this.themeForm,..."edit"==e&&{themeIndex:this.themeIndex},configType:"topic_config"})},addTheme(){this.themeForm={},this.addThemeTitle="新增",this.addThemeVisible=!0},submitConfigForm(e){this.$refs[e].validate(e=>{e&&this.$emit("sumbitData",{server_config:this.server_config,notice_config:this.notice_config,report_config:this.report_config,topic_config:this.topic_config})})},success(){this.addThemeVisible=!1}}},h=f,g=(0,c.A)(h,d,u,!1,null,"2497d8bd",null),_=g.exports,b=i(5986),y={components:{http:m,Mqtt:_},data(){return{dataList:[],dataParams:{page:1,size:8},addVisible:!1,addForm:{},rules:{apply_name:[{required:!0,message:"请输入",trigger:"blur"}],apply_type:[{required:!0,message:"请选择",trigger:"change"}]},pageShow:!0,activeName:"1",server_config:{},notice_config:{},report_config:{timeout:60,report_interval:60},topic_config:[],apply_id:"",configInfo:{},addThemeVisible:!1,themeForm:{},http_config:[],addThemeTitle:"新增",themeIndex:0,componentKey:0,componentName:"http",dataType:new Map([[1,"mqtt"],[2,"http"],[3,"分析报警"]]),configForm:{},loading:!1}},created(){this.getData()},methods:{submitThemeForm(e,t){"add"==e?this.configForm[t.configType].unshift(t.themeForm):"edit"==e?this.configForm[t.configType].splice(t.themeIndex,1,t.themeForm):this.configForm[t.configType].splice(t.themeIndex,1),this.$api.post("/apply/setApplyConfig",{apply_id:this.configInfo.apply_id,apply_config:(0,b.q)(this.configForm)}).then(()=>{this.$refs.configRef.success(),this.$message.success("操作成功"),this.getApplyMqtt()})},getApplyMqtt(){this.server_config={},this.notice_config={},this.report_config=1==this.configInfo.apply_type?{}:{timeout:60,report_interval:60},this.topic_config=[],this.http_config=[],this.$api.get("/apply/getApplyConfig",{params:{apply_id:this.configInfo.apply_id}}).then(e=>{if(e.data.data){let t=JSON.parse(e.data.data.apply_config||"{}");const{server_config:i,notice_config:o,report_config:a,topic_config:r,http_config:s}=t;this.configForm={server_config:i||{},notice_config:o||{},report_config:a||{},topic_config:r||[],http_config:s||[]}}})},submitConfigForm(e){this.$api.post("/apply/setApplyConfig",{apply_id:this.configInfo.apply_id,apply_config:(0,b.q)(e)}).then(()=>{this.$message.success("操作成功"),this.getApplyMqtt()})},configData(e){this.activeName="1",this.configInfo={...e},this.getApplyMqtt(),this.componentName=this.dataType.get(this.configInfo.apply_type),this.componentKey=`${this.componentName}_${Date.now()}`,this.pageShow=!1},changeState(e){this.$api.post("/apply/setDataApplyStatus",{apply_id:e.apply_id,apply_status:e.apply_status}).then(()=>{this.$message.success("操作成功"),this.getData()})},delData(e){this.$confirm("是否删除该数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$api.post("/apply/delDataApply",{apply_id:e.apply_id}).then(()=>{this.$message.success("操作成功"),this.getData()})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},editData(e){this.addForm={...e},this.addVisible=!0},submitForm(e){this.addForm.apply_status=1,this.$refs[e].validate(e=>{if(!e)return!1;this.addForm.apply_id?this.$api.post("/apply/updateDataApply",this.addForm).then(()=>{this.addVisible=!1,this.$message.success("操作成功"),this.getData()}):this.$api.post("/apply/addDataApply",this.addForm).then(()=>{this.addVisible=!1,this.$message.success("操作成功"),this.getData()})})},addData(){this.addForm={},this.addVisible=!0},getData(){this.loading=!0,this.$api.get("/apply/getDataApplyList",{params:this.dataParams}).then(e=>{this.dataList=e.data.data}).finally(()=>{this.loading=!1})},checkArrayState(e){return null!==e&&(0!==e.length&&!e.includes("null"))}}},v=y,F=(0,c.A)(v,o,a,!1,null,"49a8a464",null),x=F.exports},5986:function(e,t,i){i.d(t,{q:function(){return o},x:function(){return a}});i(3239),i(2401),i(3325),i(2917);function o(e){return Object.entries(e).reduce((e,[t,i])=>{if(Array.isArray(i)){const a=i.map(e=>"object"===typeof e?o(e):e).filter(e=>null!=e);a.length&&(e[t]=a)}else if(i&&"object"===typeof i){const a=o(i);Object.keys(a).length&&(e[t]=a)}else""!==i&&null!=i&&(e[t]=i);return e},{})}function a(e,t){const i=new Date(e),o={"y+":i.getFullYear().toString(),"M+":(i.getMonth()+1).toString(),"d+":i.getDate().toString(),"h+":i.getHours().toString(),"m+":i.getMinutes().toString(),"s+":i.getSeconds().toString()};for(const a in o){const e=new RegExp("("+a+")").exec(t);e&&(t=t.replace(e[1],1===e[1].length?o[a]:o[a].padStart(e[1].length,"0")))}return t}}}]);
//# sourceMappingURL=53.9c96d8e9.js.map