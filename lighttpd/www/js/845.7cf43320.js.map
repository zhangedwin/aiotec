{"version":3,"file":"js/845.7cf43320.js","mappings":"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","sources":["webpack://videogatewayweb/./src/views/system/ping.vue","webpack://videogatewayweb/src/views/system/ping.vue","webpack://videogatewayweb/./src/views/system/ping.vue?78e9","webpack://videogatewayweb/./src/views/system/ping.vue?fed8"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',[_c('el-form',{ref:\"ruleForm\",staticClass:\"demo-ruleForm mt-30\",attrs:{\"model\":_vm.ruleForm,\"rules\":_vm.rules,\"label-width\":\"130px\",\"size\":\"small\"}},[_c('el-form-item',{attrs:{\"label\":\"IP地址或者域名:\",\"prop\":\"tool_url\"}},[_c('el-input',{staticStyle:{\"width\":\"30%\"},model:{value:(_vm.ruleForm.tool_url),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"tool_url\", $$v)},expression:\"ruleForm.tool_url\"}})],1),_c('el-form-item',{attrs:{\"label\":\"检测结果:\",\"prop\":\"save_duration\"}},[_c('el-input',{staticStyle:{\"width\":\"80%\"},attrs:{\"type\":\"textarea\",\"autosize\":{ minRows: 6, maxRows: 18 },\"readonly\":\"\"},model:{value:(_vm.ruleForm.tool_info),callback:function ($$v) {_vm.$set(_vm.ruleForm, \"tool_info\", $$v)},expression:\"ruleForm.tool_info\"}})],1),_c('el-form-item',[(!_vm.isTask)?_c('el-button',{attrs:{\"type\":\"primary\",\"loading\":_vm.loading},on:{\"click\":function($event){return _vm.submitForm('ruleForm')}}},[_vm._v(\" 开始检测 \")]):_c('el-button',{attrs:{\"type\":\"danger\"},on:{\"click\":_vm.stopTask}},[_vm._v(\"停止检测\")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <el-form\r\n      :model=\"ruleForm\"\r\n      :rules=\"rules\"\r\n      ref=\"ruleForm\"\r\n      label-width=\"130px\"\r\n      class=\"demo-ruleForm mt-30\"\r\n      size=\"small\"\r\n    >\r\n      <el-form-item label=\"IP地址或者域名:\" prop=\"tool_url\">\r\n        <el-input v-model=\"ruleForm.tool_url\" style=\"width: 30%\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"检测结果:\" prop=\"save_duration\">\r\n        <el-input\r\n          type=\"textarea\"\r\n          v-model=\"ruleForm.tool_info\"\r\n          :autosize=\"{ minRows: 6, maxRows: 18 }\"\r\n          style=\"width: 80%\"\r\n          readonly\r\n        />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button\r\n          v-if=\"!isTask\"\r\n          type=\"primary\"\r\n          @click=\"submitForm('ruleForm')\"\r\n          :loading=\"loading\"\r\n        >\r\n          开始检测\r\n        </el-button>\r\n        <el-button v-else type=\"danger\" @click=\"stopTask\">停止检测</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    let validateIP = (rule, value, callback) => {\r\n      const ipv4Regex =\r\n        /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;\r\n      const domainRegex = /^([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$/;\r\n      if (!ipv4Regex.test(value) && !domainRegex.test(value)) {\r\n        callback(new Error(\"IP地址或者域名格式输入不正确\"));\r\n      } else {\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      ruleForm: {\r\n        tool_url: \"\",\r\n        tool_info: \"\",\r\n      },\r\n      rules: {\r\n        tool_url: [\r\n          {\r\n            required: true,\r\n            message: \"请输入IP或域名\",\r\n            trigger: [\"blur\", \"change\"],\r\n          },\r\n          { validator: validateIP, trigger: [\"blur\", \"change\"] },\r\n        ],\r\n      },\r\n      isTask: false,\r\n      loading: false,\r\n      timer: null,\r\n      tool_tag: 1,\r\n    };\r\n  },\r\n  methods: {\r\n    async getPing() {\r\n      try {\r\n        const res = await this.$api.get(\"/sys/getPing\");\r\n        let data = res.data.data;\r\n        if (data) {\r\n          this.$set(this.ruleForm, \"tool_info\", data.tool_info);\r\n          this.tool_tag = data.tool_tag;\r\n        }\r\n        return true;\r\n      } catch (error) {\r\n        console.error(\"获取检测结果失败:\", error);\r\n        return false;\r\n      }\r\n    },\r\n\r\n    async startPolling() {\r\n      console.log(this.tool_tag);\r\n      const poll = async () => {\r\n        this.isTask = this.tool_tag == 1 ? true : false;\r\n        if (!this.isTask) return;\r\n        const success = await this.getPing();\r\n        if (success && this.isTask) {\r\n          this.timer = setTimeout(poll, 1000);\r\n        }\r\n      };\r\n\r\n      await poll();\r\n    },\r\n\r\n    async submitForm(formName) {\r\n      this.ruleForm.tool_info = \"\";\r\n      this.tool_tag = 1;\r\n      try {\r\n        const valid = await this.$refs[formName].validate();\r\n        if (!valid) return;\r\n\r\n        this.loading = true;\r\n        await this.$api.post(\"/sys/startPing\", {\r\n          tool_url: this.ruleForm.tool_url,\r\n        });\r\n        await this.startPolling();\r\n      } catch (error) {\r\n        console.error(\"启动检测失败:\", error);\r\n      } finally {\r\n        this.loading = false;\r\n      }\r\n    },\r\n\r\n    async stopTask() {\r\n      try {\r\n        await this.$api.post(\"/sys/stopPing\");\r\n        this.isTask = false;\r\n        clearTimeout(this.timer);\r\n        this.timer = null;\r\n      } catch (error) {\r\n        console.error(\"停止检测失败:\", error);\r\n      }\r\n    },\r\n  },\r\n\r\n  beforeDestroy() {\r\n    if (this.timer) {\r\n      clearTimeout(this.timer);\r\n      this.timer = null;\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.mt-30 {\r\n  margin-top: 30px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/.pnpm/thread-loader@3.0.4_webpack@5.101.2/node_modules/thread-loader/dist/cjs.js!../../../node_modules/.pnpm/babel-loader@8.4.1_mlq2w24ovccw2zzwyvf7z5k5qa/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/.pnpm/vue-loader@15.11.1_7z3qvuhbfa5xwvetfv2z7hc6ey/node_modules/vue-loader/lib/index.js??vue-loader-options!./ping.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/.pnpm/thread-loader@3.0.4_webpack@5.101.2/node_modules/thread-loader/dist/cjs.js!../../../node_modules/.pnpm/babel-loader@8.4.1_mlq2w24ovccw2zzwyvf7z5k5qa/node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/.pnpm/vue-loader@15.11.1_7z3qvuhbfa5xwvetfv2z7hc6ey/node_modules/vue-loader/lib/index.js??vue-loader-options!./ping.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./ping.vue?vue&type=template&id=0db48a08&scoped=true\"\nimport script from \"./ping.vue?vue&type=script&lang=js\"\nexport * from \"./ping.vue?vue&type=script&lang=js\"\nimport style0 from \"./ping.vue?vue&type=style&index=0&id=0db48a08&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/.pnpm/vue-loader@15.11.1_7z3qvuhbfa5xwvetfv2z7hc6ey/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0db48a08\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","ref","staticClass","attrs","ruleForm","rules","staticStyle","model","value","tool_url","callback","$$v","$set","expression","minRows","maxRows","tool_info","isTask","on","stopTask","_v","loading","$event","submitForm","staticRenderFns","data","validateIP","rule","ipv4Regex","domainRegex","test","Error","required","message","trigger","validator","timer","tool_tag","methods","getPing","res","$api","get","error","console","startPolling","log","poll","success","setTimeout","formName","valid","$refs","validate","post","clearTimeout","beforeDestroy","component"],"sourceRoot":""}