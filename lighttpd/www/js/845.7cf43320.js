"use strict";(self["webpackChunkvideogatewayweb"]=self["webpackChunkvideogatewayweb"]||[]).push([[845],{2845:function(t,o,e){e.r(o),e.d(o,{default:function(){return u}});var r=function(){var t=this,o=t._self._c;return o("div",[o("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm mt-30",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"130px",size:"small"}},[o("el-form-item",{attrs:{label:"IP地址或者域名:",prop:"tool_url"}},[o("el-input",{staticStyle:{width:"30%"},model:{value:t.ruleForm.tool_url,callback:function(o){t.$set(t.ruleForm,"tool_url",o)},expression:"ruleForm.tool_url"}})],1),o("el-form-item",{attrs:{label:"检测结果:",prop:"save_duration"}},[o("el-input",{staticStyle:{width:"80%"},attrs:{type:"textarea",autosize:{minRows:6,maxRows:18},readonly:""},model:{value:t.ruleForm.tool_info,callback:function(o){t.$set(t.ruleForm,"tool_info",o)},expression:"ruleForm.tool_info"}})],1),o("el-form-item",[t.isTask?o("el-button",{attrs:{type:"danger"},on:{click:t.stopTask}},[t._v("停止检测")]):o("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(o){return t.submitForm("ruleForm")}}},[t._v(" 开始检测 ")])],1)],1)],1)},l=[],s={data(){let t=(t,o,e)=>{const r=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,l=/^([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}$/;r.test(o)||l.test(o)?e():e(new Error("IP地址或者域名格式输入不正确"))};return{ruleForm:{tool_url:"",tool_info:""},rules:{tool_url:[{required:!0,message:"请输入IP或域名",trigger:["blur","change"]},{validator:t,trigger:["blur","change"]}]},isTask:!1,loading:!1,timer:null,tool_tag:1}},methods:{async getPing(){try{const t=await this.$api.get("/sys/getPing");let o=t.data.data;return o&&(this.$set(this.ruleForm,"tool_info",o.tool_info),this.tool_tag=o.tool_tag),!0}catch(t){return console.error("获取检测结果失败:",t),!1}},async startPolling(){console.log(this.tool_tag);const t=async()=>{if(this.isTask=1==this.tool_tag,!this.isTask)return;const o=await this.getPing();o&&this.isTask&&(this.timer=setTimeout(t,1e3))};await t()},async submitForm(t){this.ruleForm.tool_info="",this.tool_tag=1;try{const o=await this.$refs[t].validate();if(!o)return;this.loading=!0,await this.$api.post("/sys/startPing",{tool_url:this.ruleForm.tool_url}),await this.startPolling()}catch(o){console.error("启动检测失败:",o)}finally{this.loading=!1}},async stopTask(){try{await this.$api.post("/sys/stopPing"),this.isTask=!1,clearTimeout(this.timer),this.timer=null}catch(t){console.error("停止检测失败:",t)}}},beforeDestroy(){this.timer&&(clearTimeout(this.timer),this.timer=null)}},i=s,a=e(6790),n=(0,a.A)(i,r,l,!1,null,"0db48a08",null),u=n.exports}}]);
//# sourceMappingURL=845.7cf43320.js.map