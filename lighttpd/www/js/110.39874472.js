"use strict";(self["webpackChunkvideogatewayweb"]=self["webpackChunkvideogatewayweb"]||[]).push([[110],{7110:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flex-interval",staticStyle:{height:"100%"}},[t("div",{staticClass:"tree"},[t("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",attrs:{data:e.deviceList,props:e.defaultProps,"highlight-current":"","node-key":"id",load:e.loadNode,lazy:"","default-expanded-keys":[e.sourceId]},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function({data:a}){return t("span",{staticClass:"custom-tree-node",attrs:{title:e.displayContent(a)}},[e._v(" "+e._s(e.displayContent(a))+" ")])}}])})],1),t("div",{staticClass:"p-15",staticStyle:{width:"65vw",overflow:"auto"}},[t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"报警记录",name:"1"}}),t("el-tab-pane",{attrs:{label:"数据记录",name:"2"}}),t(e.componentsListName,{key:e.componentKey,ref:"recordsRef",tag:"component",attrs:{chooseItem:e.chooseItem,activeName:e.activeName,recordsList:e.recordsList,AiValueList:e.AiValueList}}),t("pagination",{directives:[{name:"show",rawName:"v-show",value:e.aiTotal>0,expression:"aiTotal > 0"}],staticClass:"float-right mt-10 mb-10",attrs:{total:e.aiTotal,page:e.attributeParams.page,limit:e.attributeParams.size,layout:"total, prev, pager, next",small:""},on:{"update:page":function(t){return e.$set(e.attributeParams,"page",t)},"update:limit":function(t){return e.$set(e.attributeParams,"size",t)},pagination:function(t){"1"==e.activeName?e.getDataList():e.getDataAiValueList()}}})],1)],1)])},r=[],s=(a(3239),a(7644),a(3325),function(){var e=this,t=e._self._c;return t("div",["1"==e.activeName?t("el-table",{attrs:{data:e.recordsList}},[t("el-table-column",{attrs:{label:"报警图片",align:"center",prop:"ai_file"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.ai_file?t("el-image",{staticStyle:{width:"150px",height:"85px"},attrs:{src:`${a.row.ai_file}`,"preview-src-list":[`${a.row.ai_file}`],fit:"fill",referrerpolicy:"no-referrer"}}):t("span",[e._v("暂无图片")])]}}],null,!1,1000676452)}),t("el-table-column",{attrs:{label:"报警时间",align:"center",prop:"time"}}),t("el-table-column",{attrs:{label:"事件名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.ai_value?JSON.parse(t.row.ai_value).ai_name:"--")+" ")]}}],null,!1,1017336452)}),t("el-table-column",{attrs:{label:"分析内容",align:"center",prop:"analyse_threshold"},scopedSlots:e._u([{key:"default",fn:function(a){return a.row.ai_value?[t("div",e._l(e.parsedData(a.row.ai_value).slice(0,4),function(a,i){return t("div",{key:"preview_"+i,staticStyle:{"text-align":"center"}},[e._v(" "+e._s(a.name)+": "+e._s(e._f("toFixed")(a.confidence))+" ")])}),0),e.shouldShowMore(e.parsedData(a.row.ai_value))?t("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[e._l(e.parsedData(a.row.ai_value),function(a,i){return t("div",{key:"detail_"+i,staticStyle:{"text-align":"center"}},[e._v(" "+e._s(a.name)+": "+e._s(e._f("toFixed")(a.confidence))+" ")])}),t("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("查看全部")])],2):e._e()]:void 0}}],null,!0)})],1):t("el-table",{attrs:{data:e.AiValueList}},[t("el-table-column",{attrs:{label:"最新图片",align:"center",prop:"value"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.value?t("el-image",{staticStyle:{width:"150px",height:"85px"},attrs:{src:`${a.row.value}`,"preview-src-list":[`${a.row.value}`],fit:"fill",referrerpolicy:"no-referrer"}}):t("span",[e._v("暂无图片")])]}}])}),t("el-table-column",{attrs:{label:"时间",align:"center",prop:"time"}})],1)],1)}),l=[],o={props:{chooseItem:{type:Object,default:()=>({})},activeName:{type:String},recordsList:{type:Array,default:()=>[]},AiValueList:{type:Array,default:()=>[]}},data(){return{chooseItemInfo:{},attributeTotal:0,attributeParams:{page:1,size:10}}},filters:{toFixed(e){return Number(e).toFixed(2)}},created(){this.chooseItemInfo={...this.chooseItem}},methods:{parsedData(e){try{return JSON.parse(e).ai_class||[]}catch(t){return console.error("解析ai_value失败:",t),[]}},shouldShowMore(e){return e.length>4}}},n=o,d=a(6790),c=(0,d.A)(n,s,l,!1,null,"7e2f5013",null),u=c.exports,p=function(){var e=this,t=e._self._c;return t("div",["1"==e.activeName?t("el-table",{attrs:{data:e.recordsList}},[t("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identifier"}}),t("el-table-column",{attrs:{label:"最新值",align:"center",prop:"ai_value"}}),t("el-table-column",{attrs:{label:"报警时间",align:"center",prop:"time"}})],1):t("el-table",{attrs:{data:e.AiValueList}},[t("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identifier"}}),t("el-table-column",{attrs:{label:"最新值",align:"center",prop:"value"}}),t("el-table-column",{attrs:{label:"时间",align:"center",prop:"time"}})],1)],1)},h=[],m={props:{chooseItem:{type:Object,default:()=>({})},activeName:{type:String},recordsList:{type:Array,default:()=>[]},AiValueList:{type:Array,default:()=>[]}},data(){return{chooseItemInfo:{},attributeTotal:0,attributeParams:{page:1,size:10}}},created(){this.chooseItemInfo={...this.chooseItem}},methods:{parsedData(e){try{return JSON.parse(e.ai_value)||[]}catch(t){return console.error("解析ai_value失败:",t),[]}},shouldShowMore(e){return this.parsedData(e).length>4}}},f=m,v=(0,d.A)(f,p,h,!1,null,"70602b95",null),g=v.exports,_=function(){var e=this,t=e._self._c;return t("div",[e._v("gb28181")])},b=[],y={},L=y,w=(0,d.A)(L,_,b,!1,null,"a562b44c",null),N=w.exports,x={components:{onvif:u,Modbus:g,GB28181:N},data(){return{defaultProps:{label:"source_name",children:"children"},recordsList:[],chooseItem:{},attributeParams:{page:1,size:10},deviceList:[],activeName:"1",expandedKeys:[],checkedKeys:[],sourceId:0,AiValueList:[],aiTotal:0,componentKey:0,componentsListName:"onvif",source_type:new Map([[1,"Modbus"],[2,"onvif"],[3,"onvif"],[4,"Modbus"]]),loading:!1}},created(){this.getDeviceList()},mounted(){this.setStyle()},filters:{toFixed(e){return Number(e).toFixed(2)}},methods:{parsedData(e){try{return JSON.parse(e.ai_value)||[]}catch(t){return console.error("解析ai_value失败:",t),[]}},shouldShowMore(e){return this.parsedData(e).length>4},getDataAiValueList(){this.$api.get("/collect/getDataRecordList",{params:this.attributeParams}).then(e=>{e.data.data?(this.AiValueList=e.data.data,this.aiTotal=e.data.total):this.AiValueList=[]})},getDataList(){this.$api.get("/ai/getDataAiRecordList",{params:this.attributeParams}).then(e=>{e.data.data?(this.recordsList=e.data.data,this.aiTotal=e.data.total):(this.aiTotal=0,this.recordsList=[])})},displayContent(e){const{describe:t,driver_protocol:a,source_name:i,identifier:r}=e;return t||a&&i||r},loadNode(e,t){return 0===e.level||2===e.level&&2==e.data.driver_protocol?t([]):(e.data.loaded=!0,void this.$api.get("/collect/getDataPropertyList",{params:{source_id:e.parent.data.id||e.data.id,...2!=e.data.driver_protocol&&{parent_id:e.data.parent_id||0}}}).then(async a=>{if(a.data.data){const i=a.data.data.map(t=>({describe:t.describe,id:t.pro_id,driver_protocol:e.data.driver_protocol,parent_id:t.identifier}));return t(i)}return t([])}))},handleClick(e){this.recordsList=[],this.AiValueList=[],this.aiTotal=0,this.attributeParams.page=1,this.componentKey=`${this.componentsListName}_${Date.now()}`,"0"==e.index?this.getDataList():this.getDataAiValueList()},getDeviceList(){this.loading=!0,this.$api.get("/collect/getDataSourceList",{params:this.dataSource}).then(e=>{this.deviceList=e.data.data.map(e=>({...e,id:e.source_id,loaded:!1}));const t=this.$route.query.source_id?Number(this.$route.query.source_id):this.deviceList[0]?.id;t&&(this.sourceId=t,this.$nextTick(()=>this.handleInitialNode(t)))}).finally(()=>{this.loading=!1})},handleInitialNode(e){if(this.$route.query.source_id){const t=this.$refs.tree?.getNode(e);if(!t)return;this.loadNode(t,e=>{if(!e?.length)return;const t=this.$route.query.pro_id?e.find(e=>e.id==this.$route.query.pro_id):e[0];if(!t)return;const a=this.$refs.tree.getNode(t);a&&(this.handleNodeClick(t,a),this.$refs.tree.setCurrentKey(t.id))})}else{const e=this.deviceList[0];if(!e)return;const t=this.$refs.tree.getNode(e);t&&(this.handleNodeClick(e,t),this.$refs.tree.setCurrentKey(this.sourceId))}},setStyle(){const e=document.querySelector(".el-main");e&&(e.style.padding="0px",e.style.overflow="hidden")},handleNodeClick(e,t){this.recordsList=[],this.AiValueList=[],this.aiTotal=0,this.activeName="1",this.chooseItem=e,this.attributeParams={page:1,size:10},1==t.level?this.attributeParams.source_id=e.id:this.attributeParams.pro_id=e.id,this.componentsListName=this.source_type.get(this.chooseItem.driver_protocol),this.componentKey=`${this.componentsListName}_${Date.now()}`,this.getDataList()},getAttributeList(){}},beforeDestroy(){const e=document.querySelector(".el-main");e&&(e.style.padding="20px",e.style.overflow="auto")}},S=x,k=(0,d.A)(S,i,r,!1,null,"26c96d04",null),$=k.exports}}]);
//# sourceMappingURL=110.39874472.js.map